專案名稱：一頁式銷售網站規格書

1. 專案目標

建立一個高效能、易於維護的單頁式銷售網站 (One-Page Website)。使用者可以在同一個頁面上瀏覽商品、加入購物車、結帳，並使用綠界 (ECPay) 金流完成付款。訂單將自動記錄於 Google Sheets，並觸發 Email 通知客戶。

2. 技術堆疊 (Tech Stack)

前端框架 (Frontend): React.js (使用 Vite)

原因： React 能輕鬆管理「狀態」（例如購物車內容、訂單金額），非常適合處理有互動邏D輯的網站。

前端樣式 (Styling): Tailwind CSS

原因： 能快速建立現代化且響應式 (RWD) 的設計，無需撰寫大量 CSS。

網站託管 (Hosting): Netlify

原因： 提供靜態網站託管及 Serverless Functions 功能。

後端邏D輯 (Backend): Netlify Functions (Node.js)

原因： 用於安全處理綠界金流的 API 串接（存放密鑰）。

資料庫 (Database): Google Sheets (Google 試算表)

原因： 作為訂單後台，方便您隨時查看與管理。

自動化 (Automation): Google Apps Script

原因： 負責接收訂單並自動寄送 Email。

3. 頁面結構與功能 (單一頁面)

3.1 產品展示區 (Product Section)

內容：

主要產品照片（可多張輪播）。

產品標題、詳細說明、規格。

產品價格。

功能：

「加入購物車」按鈕 (點擊後，購物車圖示應顯示數量)。

(可選) 數量選擇器。

3.2 購物車 (Shopping Cart)

形式： 一個彈出式視窗 (Modal) 或側邊欄 (Sidebar)。

內容：

顯示已加入的商品、單價、數量、小計。

顯示總金額。

功能：

「前往結帳」按鈕。

(可選) 刪除商品、修改數量。

3.3 結帳表單 (Checkout Form)

形式： 點擊「前往結帳」後顯示的區塊或彈窗。

內容 (欄位)：

顧客資料： 姓名、Email (用於寄送訂單通知)、手機。

(可選) 運送資料： 地址（如果需要）。

帳單邏輯 (重點)：

稅金： 系統應自動計算 5% 營業稅並顯示（或內含）。

發票： 提供選項（例如：二聯式電子發票、三聯式統編）。若選三聯式，需顯示「公司抬頭」與「統一編號」欄位。

功能：

「前往綠界付款」按鈕。

3.4 感謝頁面 (Thank You Page)

形式： 一個獨立的靜態頁面 (例如 /thank-you) 或在原頁面顯示的訊息。

內容：

當使用者從綠界刷卡成功後，會被導向此頁面。

顯示「感謝您的購買！訂單已成立」訊息。

顯示訂單編號（由綠界回傳）。

邏輯：

也需要一個「付款失敗」的頁面或訊息 (例如 /payment-failed)。

4. 後端邏輯 (Netlify Functions)

後端邏輯不放在前端 React 程式碼中，而是獨立的 Serverless Functions。

4.1 Function 1: create-ecpay-order (建立綠界訂單)

觸發： 使用者在前端點擊「前往綠界付款」按鈕時。

任務：

從前端接收訂單資料（品項、總金額、顧客 Email 等）。

安全地從 Netlify 環境變數讀取綠界的 HashKey 和 HashIV (密鑰)。

產生一組唯一的「商店訂單編號」(MerchantTradeNo)。

依據綠界規格，將所有參數組合並產生加密簽名 (CheckMacValue)。

回傳一個包含所有訂單參數與簽名的「表單」，前端 React 收到後會自動提交 (submit) 此表單，將使用者導向綠界刷卡頁。

4.2 Function 2: notify-google-sheet (寫入訂單到 Google)

觸發： 由綠界後端系統在「付款成功」或「付款失敗」時主動呼叫 (您必須將此 Function 的網址設定在綠界後台的 PaymentInfoURL 欄位)。

任務：

接收綠界傳來的付款結果 (POST 請求)。

驗證綠界傳來的 CheckMacValue，確保請求是合法的。

如果付款成功 (RtnCode = 1)：

組合訂單資料（訂單編號、顧客 Email、金額、付款狀態...）。

使用 fetch 向 Google Apps Script 提供的「Web App 網址」發送 POST 請求，將這筆訂單資料傳過去。

回傳 1|OK 給綠界，表示已收到通知。

註： 這支 Function 的唯一工作就是「驗證綠界通知」並「轉發給 Google Sheets」，不做其他複雜邏輯。

5. Email 系統 (可編輯內容)

需求： 您 (網站管理者) 需要能隨時修改寄給客戶的 Email 內容。

實作：

編輯介面： 在 Google Sheet 中建立一個名為 EmailTemplate 的分頁。

欄位： 在此分頁中建立 Subject (主旨) 和 Body (內文) 欄位。

內容： 您可以在 Body 欄位中撰寫 Email 內容，並使用「佔位符」 (例如 {CUSTOMER_NAME}、{ORDER_NUMBER}) 來代表變數。

邏輯： Google Apps Script 在寄信前，會先來這個分頁讀取主旨和內文，然後再將佔位符替換成真實的訂單資料。